!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FaceAuth=t():e.FaceAuth=t()}(this,()=>{return e={291:(e,t)=>{var n;class s{constructor(e={}){if(this.config={detectionInterval:200,progressStep:1,progressIntervalTime:100,minFaceSize:.3,maxFaceSize:.6,centerThreshold:.15,warningThreshold:.25,onCapture:null,onClose:null,onError:null,...e},this.stream=null,this.progressInterval=null,this.progress=0,this.isCentered=!1,this.isCapturing=!1,this.faceDetectionModel=null,this.detectionInterval=null,this.voiceEnabled=!0,this.isSpeaking=!1,this.foreignObjectDetected=!1,this.faceValidationChecks={hasBothEyes:!1,hasNose:!1,hasMouth:!1,isFullFace:!1},"undefined"==typeof faceLandmarksDetection)throw new Error("FaceLandmarksDetection is required. Please include it before FaceAuth.");if("undefined"==typeof tf)throw new Error("TensorFlow.js is required. Please include it before FaceAuth.");this.initDOM(),this.initEventListeners(),this.initVoice()}initDOM(){document.getElementById("faceAuthOverlay")||this.createPopupStructure(),this.cacheDOMElements()}createPopupStructure(){const e=document.createElement("div");e.className="face-auth-overlay",e.id="faceAuthOverlay";const t=document.createElement("div");t.className="face-auth-popup",t.id="faceAuthPopup",t.innerHTML='\n            <div class="face-auth-header">\n                <div>\n                    <div class="face-auth-title">Xác Thực Khuôn Mặt</div>\n                    <div class="face-auth-subtitle">Hệ thống sẽ hướng dẫn bạn định vị khuôn mặt</div>\n                </div>\n                <div class="face-auth-header-controls">\n                    <button class="face-auth-voice-toggle" id="faceAuthVoiceToggle" title="Bật/Tắt giọng nói">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>\n                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>\n                            <line x1="12" y1="19" x2="12" y2="23"></line>\n                            <line x1="8" y1="23" x2="16" y2="23"></line>\n                        </svg>\n                    </button>\n                    <button class="face-auth-close-btn" id="faceAuthCloseBtn">×</button>\n                </div>\n            </div>\n            <div class="face-auth-body">\n                <div class="face-auth-loading-container" id="faceAuthLoadingModels">\n                    <div class="face-auth-spinner"></div>\n                    <h3>Đang tải hệ thống</h3>\n                    <p>Xin đợi một lát...</p>\n                </div>\n\n                <div id="faceAuthCameraContent" class="face-auth-hidden">\n                    <div class="face-auth-content">\n                        <div class="face-auth-video-container">\n                            <video class="face-auth-video" id="faceAuthVideo" autoplay playsinline></video>\n                            <div class="face-auth-video-overlay">\n                                <div class="face-auth-mask" id="faceAuthMask"></div>\n                            </div>\n                        </div>\n\n                        <div class="face-auth-sidebar">\n                            <div class="face-auth-instructions">\n                                <ul>\n                                    <li>Giữ khuôn mặt ở giữa khung hình</li>\n                                    <li>Đảm bảo ánh sáng đầy đủ và rõ ràng</li>\n                                    <li>Giữ nguyên tư thế khi hệ thống đang xác thực</li>\n                                </ul>\n                            </div>\n\n                            <div class="face-auth-status-container">\n                                <div class="face-auth-status-text" id="faceAuthStatusText">Đang khởi tạo camera...</div>\n                                <div class="face-auth-progress-container">\n                                    <div class="face-auth-progress-bar">\n                                        <div class="face-auth-progress-fill" id="faceAuthProgressFill"></div>\n                                    </div>\n                                    <div class="face-auth-progress-text" id="faceAuthProgressText">0%</div>\n                                </div>\n                            </div>\n\n                            <div class="face-auth-error-message" id="faceAuthErrorMessage"></div>\n                            <div class="face-auth-success-message" id="faceAuthSuccessMessage"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ';const n=document.createElement("canvas");n.id="faceAuthCanvas",n.className="face-auth-hidden",document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(n),this.injectStyles()}injectStyles(){document.getElementById("face-auth-styles")||document.head.insertAdjacentHTML("beforeend",'\n            <style id="face-auth-styles">\n                .face-auth-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background-color: rgba(0, 0, 0, 0.8);\n                    backdrop-filter: blur(12px);\n                    display: none;\n                    z-index: 10000;\n                    opacity: 0;\n                    transition: opacity 0.4s ease;\n                }\n                .face-auth-overlay.show { opacity: 1; }\n                .face-auth-popup {\n                    position: fixed;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%) scale(0.9);\n                    width: 95%;\n                    max-width: 850px;\n                    max-height: 90vh;\n                    background: linear-gradient(145deg, #1e1e1e, #1a1a1a);\n                    border-radius: 16px;\n                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);\n                    overflow: hidden;\n                    z-index: 10001;\n                    display: none;\n                    opacity: 0;\n                    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n                }\n                .face-auth-popup.show {\n                    transform: translate(-50%, -50%) scale(1);\n                    opacity: 1;\n                }\n                .face-auth-header {\n                    padding: 22px;\n                    border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    background: rgba(30, 30, 30, 0.8);\n                }\n                .face-auth-title {\n                    font-size: 1.6rem;\n                    font-weight: 700;\n                    background: linear-gradient(90deg, #3a86ff, #5e9fff);\n                    -webkit-background-clip: text;\n                    -webkit-text-fill-color: transparent;\n                }\n                .face-auth-subtitle {\n                    font-size: 1rem;\n                    color: #b0b0b0;\n                    margin-top: 6px;\n                }\n                .face-auth-header-controls {\n                    display: flex;\n                    gap: 12px;\n                    align-items: center;\n                }\n                .face-auth-close-btn {\n                    background: rgba(255, 255, 255, 0.1);\n                    border: none;\n                    color: #b0b0b0;\n                    font-size: 1.5rem;\n                    cursor: pointer;\n                    width: 40px;\n                    height: 40px;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    transition: all 0.3s ease;\n                }\n                .face-auth-close-btn:hover {\n                    background: rgba(255, 255, 255, 0.15);\n                    color: #ffffff;\n                    transform: rotate(90deg);\n                }\n                .face-auth-voice-toggle {\n                    background: rgba(255, 255, 255, 0.1);\n                    border: none;\n                    color: #b0b0b0;\n                    width: 40px;\n                    height: 40px;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    cursor: pointer;\n                    transition: all 0.3s ease;\n                }\n                .face-auth-voice-toggle:hover {\n                    background: rgba(255, 255, 255, 0.15);\n                    color: #ffffff;\n                }\n                .face-auth-voice-toggle.active {\n                    color: #3a86ff;\n                    background: rgba(58, 134, 255, 0.2);\n                }\n                .face-auth-body {\n                    padding: 22px;\n                    overflow-y: auto;\n                    max-height: calc(90vh - 130px);\n                }\n                .face-auth-content {\n                    display: flex;\n                    gap: 24px;\n                    align-items: flex-start;\n                }\n                .face-auth-video-container {\n                    position: relative;\n                    width: 65%;\n                    aspect-ratio: 4/5;\n                    border-radius: 14px;\n                    overflow: hidden;\n                    background-color: #000;\n                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);\n                    flex-shrink: 0;\n                }\n                .face-auth-video {\n                    width: 100%;\n                    height: 100%;\n                    object-fit: cover;\n                    transform: scaleX(-1);\n                }\n                .face-auth-video-overlay {\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    pointer-events: none;\n                }\n                .face-auth-mask {\n                    position: absolute;\n                    top: 50%;\n                    left: 50%;\n                    transform: translate(-50%, -50%);\n                    width: 75%;\n                    height: 75%;\n                    border: 3px solid #3a86ff;\n                    border-radius: 50%;\n                    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 20px rgba(58, 134, 255, 0.4);\n                    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);\n                }\n                .face-auth-mask.good {\n                    border-color: #2ed573;\n                    box-shadow: 0 0 0 9999px rgba(46, 213, 115, 0.1), 0 0 30px rgba(46, 213, 115, 0.5);\n                    animation: face-auth-pulse 2s infinite;\n                }\n                .face-auth-mask.warning {\n                    border-color: #ffa502;\n                    box-shadow: 0 0 0 9999px rgba(255, 165, 2, 0.1), 0 0 20px rgba(255, 165, 2, 0.4);\n                }\n                .face-auth-mask.error {\n                    border-color: #ff4757;\n                    box-shadow: 0 0 0 9999px rgba(255, 71, 87, 0.1), 0 0 20px rgba(255, 71, 87, 0.4);\n                }\n                @keyframes face-auth-pulse {\n                    0% { box-shadow: 0 0 0 9999px rgba(46, 213, 115, 0.1), 0 0 30px rgba(46, 213, 115, 0.5); }\n                    50% { box-shadow: 0 0 0 9999px rgba(46, 213, 115, 0.15), 0 0 40px rgba(46, 213, 115, 0.7); }\n                    100% { box-shadow: 0 0 0 9999px rgba(46, 213, 115, 0.1), 0 0 30px rgba(46, 213, 115, 0.5); }\n                }\n                .face-auth-sidebar {\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    gap: 20px;\n                }\n                .face-auth-instructions {\n                    text-align: left;\n                    background: rgba(255, 255, 255, 0.05);\n                    padding: 18px;\n                    border-radius: 14px;\n                    backdrop-filter: blur(10px);\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                }\n                .face-auth-instructions ul {\n                    list-style-type: none;\n                    padding-left: 0;\n                }\n                .face-auth-instructions li {\n                    margin-bottom: 12px;\n                    color: #b0b0b0;\n                    display: flex;\n                    align-items: center;\n                    transition: all 0.3s ease;\n                }\n                .face-auth-instructions li:hover {\n                    color: #ffffff;\n                    transform: translateX(5px);\n                }\n                .face-auth-instructions li:before {\n                    content: "•";\n                    color: #3a86ff;\n                    font-weight: bold;\n                    margin-right: 12px;\n                    font-size: 1.4rem;\n                }\n                .face-auth-status-container {\n                    text-align: center;\n                    background: rgba(255, 255, 255, 0.05);\n                    padding: 18px;\n                    border-radius: 14px;\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                }\n                .face-auth-status-text {\n                    font-size: 1.1rem;\n                    margin-bottom: 16px;\n                    min-height: 26px;\n                    font-weight: 500;\n                    transition: all 0.3s ease;\n                }\n                .face-auth-progress-container {\n                    width: 100%;\n                    margin-top: 12px;\n                }\n                .face-auth-progress-bar {\n                    width: 100%;\n                    height: 10px;\n                    background: rgba(255, 255, 255, 0.1);\n                    border-radius: 5px;\n                    overflow: hidden;\n                    position: relative;\n                }\n                .face-auth-progress-fill {\n                    height: 100%;\n                    background: linear-gradient(90deg, #3a86ff, #2ed573);\n                    border-radius: 5px;\n                    width: 0%;\n                    transition: width 0.5s ease;\n                    position: relative;\n                    overflow: hidden;\n                }\n                .face-auth-progress-fill::after {\n                    content: \'\';\n                    position: absolute;\n                    top: 0;\n                    left: -100%;\n                    width: 100%;\n                    height: 100%;\n                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);\n                    animation: face-auth-shine 2s infinite;\n                }\n                @keyframes face-auth-shine {\n                    0% { left: -100%; }\n                    100% { left: 100%; }\n                }\n                .face-auth-progress-text {\n                    text-align: center;\n                    margin-top: 10px;\n                    font-size: 1rem;\n                    color: #b0b0b0;\n                    font-weight: 500;\n                }\n                .face-auth-error-message {\n                    color: #ff4757;\n                    margin-top: 16px;\n                    padding: 14px;\n                    background: rgba(255, 71, 87, 0.1);\n                    border-radius: 12px;\n                    display: none;\n                    border-left: 4px solid #ff4757;\n                }\n                .face-auth-success-message {\n                    color: #2ed573;\n                    margin-top: 16px;\n                    padding: 14px;\n                    background: rgba(46, 213, 115, 0.1);\n                    border-radius: 12px;\n                    display: none;\n                    border-left: 4px solid #2ed573;\n                }\n                .face-auth-loading-container {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    padding: 50px 20px;\n                    text-align: center;\n                }\n                .face-auth-spinner {\n                    width: 60px;\n                    height: 60px;\n                    border: 4px solid rgba(58, 134, 255, 0.3);\n                    border-radius: 50%;\n                    border-top-color: #3a86ff;\n                    animation: face-auth-spin 1s linear infinite;\n                    margin-bottom: 24px;\n                }\n                @keyframes face-auth-spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n                .face-auth-hidden {\n                    display: none;\n                }\n                .face-auth-fade-in {\n                    animation: face-auth-fadeIn 0.5s ease forwards;\n                }\n                @keyframes face-auth-fadeIn {\n                    from { opacity: 0; transform: translateY(20px); }\n                    to { opacity: 1; transform: translateY(0); }\n                }\n                @media (max-width: 900px) {\n                    .face-auth-popup { width: 98%; max-height: 95vh; }\n                    .face-auth-body { max-height: calc(95vh - 130px); padding: 18px; }\n                    .face-auth-header { padding: 18px; }\n                    .face-auth-content { flex-direction: column; }\n                    .face-auth-video-container { width: 100%; }\n                }\n            </style>\n        ')}cacheDOMElements(){this.overlay=document.getElementById("faceAuthOverlay"),this.popup=document.getElementById("faceAuthPopup"),this.closeBtn=document.getElementById("faceAuthCloseBtn"),this.video=document.getElementById("faceAuthVideo"),this.statusText=document.getElementById("faceAuthStatusText"),this.progressText=document.getElementById("faceAuthProgressText"),this.progressFill=document.getElementById("faceAuthProgressFill"),this.errorMessage=document.getElementById("faceAuthErrorMessage"),this.successMessage=document.getElementById("faceAuthSuccessMessage"),this.canvas=document.getElementById("faceAuthCanvas"),this.loadingModels=document.getElementById("faceAuthLoadingModels"),this.cameraContent=document.getElementById("faceAuthCameraContent"),this.faceMask=document.getElementById("faceAuthMask"),this.voiceToggle=document.getElementById("faceAuthVoiceToggle")}initEventListeners(){this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),this.voiceToggle&&this.voiceToggle.addEventListener("click",()=>this.toggleVoice()),this.overlay&&this.overlay.addEventListener("click",()=>this.close())}initVoice(){if(!("speechSynthesis"in window))return;const e=()=>{const e=window.speechSynthesis.getVoices();e&&e.length&&(this.viVoice=e.find(e=>e.lang.toLowerCase().startsWith("vi"))||e.find(e=>e.lang.toLowerCase().startsWith("en"))||e[0])};e(),window.speechSynthesis.onvoiceschanged=e}async open(){this.resetProgress(),this.hideMessages(),this.foreignObjectDetected=!1,this.resetFaceValidation(),this.overlay.style.display="block",this.popup.style.display="block",setTimeout(()=>{this.overlay.classList.add("show"),this.popup.classList.add("show")},10),this.loadingModels.classList.remove("face-auth-hidden"),this.cameraContent.classList.add("face-auth-hidden");try{await this.initialize(),this.loadingModels.classList.add("face-auth-hidden"),this.cameraContent.classList.remove("face-auth-hidden"),this.cameraContent.classList.add("face-auth-fade-in"),this.voiceEnabled&&this.speak("Xin chào! Hãy đưa khuôn mặt của bạn vào khung hình")}catch(e){console.error("Error initializing camera:",e),this.showError("Không thể khởi tạo camera. Vui lòng thử lại."),this.config.onError&&this.config.onError(e)}}close(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),this.detectionInterval&&(clearInterval(this.detectionInterval),this.detectionInterval=null),"speechSynthesis"in window&&window.speechSynthesis.cancel(),this.isSpeaking=!1,this.voiceEnabled&&this.speak("Bạn đã tắt camera"),this.overlay.classList.remove("show"),this.popup.classList.remove("show"),setTimeout(()=>{this.popup.style.display="none",this.overlay.style.display="none"},400),this.resetProgress(),this.hideMessages(),this.isCapturing=!1,this.faceMask.className="face-auth-mask",this.foreignObjectDetected=!1,this.resetFaceValidation(),this.config.onClose&&this.config.onClose()}async initialize(){await this.loadFaceDetectionModel(),await this.requestCameraAccess(),this.startFaceDetection()}async loadFaceDetectionModel(){try{this.setStatus("Đang tải hệ thống..."),this.voiceEnabled&&this.speak("Đang tải hệ thống, xin đợi một lát"),this.faceDetectionModel=await faceLandmarksDetection.load(faceLandmarksDetection.SupportedPackages.mediapipeFacemesh,{maxFaces:1,shouldLoadIrisModel:!1})}catch(e){throw new Error("Không thể tải mô hình nhận diện khuôn mặt.")}}async requestCameraAccess(){try{this.setStatus("Đang kết nối camera..."),this.stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}}),this.video.srcObject=this.stream,await new Promise(e=>{this.video.onloadedmetadata=()=>{e()}}),this.setStatus("Đang tìm khuôn mặt...")}catch(e){let t="Không thể truy cập camera. ";throw"NotAllowedError"===e.name?t+="Vui lòng cấp quyền truy cập camera.":"NotFoundError"===e.name?t+="Không tìm thấy camera.":t+="Vui lòng kiểm tra quyền trình duyệt.",new Error(t)}}startFaceDetection(){let e=0;const t=async()=>{if(!this.stream||this.isCapturing)return void requestAnimationFrame(t);const n=Date.now();if(n-e<this.config.detectionInterval)requestAnimationFrame(t);else{e=n;try{const e=await this.faceDetectionModel.estimateFaces({input:this.video,returnTensors:!1,flipHorizontal:!1,predictIrises:!1});if(e.length>0){const t=e[0],n=this.validateFace(t),s=this.checkFacePosition(t);if(e.length>1)this.foreignObjectDetected=!0,this.showError("Phát hiện nhiều khuôn mặt hoặc vật thể lạ. Vui lòng chỉ để một khuôn mặt trong khung hình."),this.resetProgress(),this.voiceEnabled&&!this.isSpeaking&&this.speak("Phát hiện vật thể lạ. Vui lòng chỉ để khuôn mặt trong khung hình.");else{if(this.foreignObjectDetected=!1,this.hideMessages(),this.checkFaceCovered(t))return this.showError("Khuôn mặt bị che. Vui lòng để lộ toàn bộ khuôn mặt."),this.resetProgress(),void(this.voiceEnabled&&!this.isSpeaking&&this.speak("Khuôn mặt bị che. Vui lòng để lộ toàn bộ khuôn mặt."));if(n.isFullFace)this.onFaceDetectionResult(s);else{let e="Không nhận diện được đầy đủ khuôn mặt. ";n.hasBothEyes||(e+="Vui lòng để lộ cả hai mắt. "),n.hasNose||(e+="Vui lòng để lộ mũi. "),n.hasMouth||(e+="Vui lòng để lộ miệng. "),this.showError(e),this.resetProgress(),this.voiceEnabled&&!this.isSpeaking&&this.speak("Vui lòng để lộ toàn bộ khuôn mặt bao gồm mắt, mũi và miệng")}}}else this.foreignObjectDetected=!1,this.resetFaceValidation(),this.hideMessages(),this.onFaceDetectionResult(!1)}catch(e){console.error("Face detection error:",e)}requestAnimationFrame(t)}};t()}checkFaceCovered(e){const t=e.keypoints||e.scaledMesh||[],n=[33,133,160,159,158,144,145,153].filter(e=>t[e]).length,s=[362,263,387,386,385,373,374,380].filter(e=>t[e]).length,i=[1,2,98,327].filter(e=>t[e]).length,a=[13,14,78,308,78,95,88,178].filter(e=>t[e]).length;if(n<3||s<3||i<2||a<3)return!0;const o=e.boundingBox;if(o){const e=o.bottomRight[0]-o.topLeft[0],t=o.bottomRight[1]-o.topLeft[1];if(e<100||t<100||e/t<.5||e/t>2)return!0}return!1}validateFace(e){this.resetFaceValidation();const t=e.keypoints||e.scaledMesh||[];return this.faceValidationChecks.hasBothEyes=[33,133,160,159,158,144,145,153].some(e=>t[e])&&[362,263,387,386,385,373,374,380].some(e=>t[e]),this.faceValidationChecks.hasNose=[1,2,98,327].some(e=>t[e]),this.faceValidationChecks.hasMouth=[13,14,78,308,78,95,88,178].some(e=>t[e]),this.faceValidationChecks.isFullFace=this.faceValidationChecks.hasBothEyes&&this.faceValidationChecks.hasNose&&this.faceValidationChecks.hasMouth,this.faceValidationChecks}resetFaceValidation(){this.faceValidationChecks={hasBothEyes:!1,hasNose:!1,hasMouth:!1,isFullFace:!1}}checkFacePosition(e){const t=e.boundingBox,n=this.video.videoWidth,s=this.video.videoHeight,i=(t.topLeft[0]+t.bottomRight[0])/2,a=(t.topLeft[1]+t.bottomRight[1])/2,o=n/2,r=s/2,h=Math.abs(i-o),c=Math.abs(a-r),l=t.bottomRight[0]-t.topLeft[0],d=t.bottomRight[1]-t.topLeft[1],g=Math.max(l,d),u=Math.min(n,s)*this.config.minFaceSize,p=Math.min(n,s)*this.config.maxFaceSize,f=h<n*this.config.centerThreshold&&c<s*this.config.centerThreshold&&g>u&&g<p;let m="",v="";return this.foreignObjectDetected?(this.faceMask.className="face-auth-mask error",m="Vui lòng chỉ để khuôn mặt trong khung hình"):this.faceValidationChecks.isFullFace?f&&g>u&&g<p?(this.faceMask.className="face-auth-mask good",m="Khuôn mặt đã ở vị trí tốt. Giữ nguyên..."):h<n*this.config.warningThreshold&&c<s*this.config.warningThreshold?(this.faceMask.className="face-auth-mask warning",g<u?(m="Hãy tiến lại gần hơn.",v="Hãy tiến lại gần hơn một chút"):g>p?(m="Hãy lùi ra xa hơn.",v="Hãy lùi ra xa hơn một chút"):(m="Hãy di chuyển khuôn mặt vào giữa khung.",v="Hãy di chuyển khuôn mặt vào giữa khung hình")):(this.faceMask.className="face-auth-mask error",m="Đưa khuôn mặt vào khung hình.",v="Xin hãy đưa khuôn mặt vào trong khung hình"):(this.faceMask.className="face-auth-mask error",m="Vui lòng để lộ toàn bộ khuôn mặt"),m!==this.lastStatus&&(this.setStatus(m),this.lastStatus=m,this.voiceEnabled&&v&&v!==this.lastVoiceMessage&&!this.isSpeaking&&!this.foreignObjectDetected&&(this.speak(v),this.lastVoiceMessage=v)),f&&g>u&&g<p&&!this.foreignObjectDetected&&this.faceValidationChecks.isFullFace}setStatus(e){this.statusText&&(this.statusText.textContent=e)}resetProgress(){this.progress=0,this.updateProgressUI(),this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)}updateProgressUI(){this.progressText&&(this.progressText.textContent=`${this.progress}%`),this.progressFill&&(this.progressFill.style.width=`${this.progress}%`)}hideMessages(){this.errorMessage&&(this.errorMessage.style.display="none"),this.successMessage&&(this.successMessage.style.display="none")}showError(e){this.errorMessage&&(this.errorMessage.textContent=e,this.errorMessage.style.display="block"),this.successMessage&&(this.successMessage.style.display="none"),this.voiceEnabled&&!this.isSpeaking&&this.speak(e)}showSuccess(e){this.successMessage&&(this.successMessage.textContent=e,this.successMessage.style.display="block"),this.errorMessage&&(this.errorMessage.style.display="none")}toggleVoice(){this.voiceEnabled=!this.voiceEnabled,this.voiceToggle&&this.voiceToggle.classList.toggle("active",this.voiceEnabled),this.voiceEnabled&&!this.isSpeaking&&this.speak("Đã bật hướng dẫn bằng giọng nói")}speak(e){if((this.voiceEnabled||e.includes("Cảm ơn")||e.includes("tắt camera"))&&"speechSynthesis"in window){window.speechSynthesis.cancel(),this.isSpeaking=!0;const t=new SpeechSynthesisUtterance(e);t.lang="vi-VN",t.rate=1.2,t.pitch=1,t.volume=.8,t.onend=()=>{this.isSpeaking=!1},t.onerror=()=>{this.isSpeaking=!1},window.speechSynthesis.speak(t)}}onFaceDetectionResult(e){this.isCapturing||this.foreignObjectDetected||!this.faceValidationChecks.isFullFace||(e&&!this.isCentered?(this.isCentered=!0,this.progressInterval||(this.progressInterval=setInterval(()=>this.increaseProgress(),this.config.progressIntervalTime)),this.voiceEnabled&&!this.isSpeaking&&this.speak("Tốt lắm! Giữ nguyên tư thế")):!e&&this.isCentered&&(this.isCentered=!1,this.resetProgress()))}increaseProgress(){this.isCentered?this.progress<100?(this.progress+=this.config.progressStep,this.updateProgressUI(),30===this.progress?(this.setStatus("Đang xác thực..."),this.voiceEnabled&&!this.isSpeaking&&this.speak("Đang xác thực khuôn mặt")):60===this.progress?(this.setStatus("Sắp xong rồi..."),this.voiceEnabled&&!this.isSpeaking&&this.speak("Sắp xong rồi, cố gắng giữ nguyên tư thế")):85===this.progress&&(this.setStatus("Cố đừng rời camera..."),this.voiceEnabled&&!this.isSpeaking&&this.speak("Cố gắng đừng rời camera"))):(clearInterval(this.progressInterval),this.progressInterval=null,this.setStatus("Tuyệt quá!"),this.voiceEnabled&&!this.isSpeaking&&this.speak("Tuyệt quá! Xác thực thành công. Cảm ơn quý khách"),this.captureImage()):this.resetProgress()}captureImage(){this.isCapturing=!0,this.setStatus("Đang chụp ảnh...");const e=this.video.videoWidth,t=this.video.videoHeight;this.canvas.width=e,this.canvas.height=t,this.canvas.getContext("2d").drawImage(this.video,0,0,e,t),this.canvas.toBlob(e=>{this.uploadImage(e)},"image/jpeg",.9)}uploadImage(e){this.setStatus("Đang gửi dữ liệu..."),this.voiceEnabled&&!this.isSpeaking&&this.speak("Đang gửi dữ liệu xác thực"),this.config.onCapture&&this.config.onCapture(e),setTimeout(()=>{this.showSuccess("Xác thực thành công!"),this.setStatus("Hoàn tất!"),setTimeout(()=>{this.close()},2e3)},1500)}updateConfig(e){this.config={...this.config,...e}}isOpen(){return"none"!==this.popup.style.display}}e.exports?e.exports=s:void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)}},t={},function n(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}(291);var e,t});